version: 0.2

phases:
  install:
    commands:
      - apt-get update
      - apt-get install -y jq zip unzip python-setuptools python-dev build-essential 
      - pip install --upgrade pip
  pre_build:
    commands:
      - chmod a+x ./utils/*
  build:
    commands:
      - git init; git config user.email "secscapipeline@example.com"; git config --global user.name "secscan pipeline" 
      - git add . -A; git commit -vm "Dummy commit to reinitialise the repo because of the GitHub integration"
      - pip install truffleHog
      - python /usr/local/lib/python3.6/site-packages/truffleHog/truffleHog.py file://$CODEBUILD_SRC_DIR
      - echo $?
