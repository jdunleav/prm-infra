version: 0.1

phases:
  install:
    commands:
      - sudo apt-get update
      - sudo apt-get install zip
  build:
    commands:      
      - git archive -o latest.zip HEAD
      - git rev-parse --short HEAD | xargs -I{} aws s3 cp latest.zip s3://prm-application-source/source-walking-skeleton-spikes/{}.zip
      - aws s3 cp latest.zip s3://prm-application-source/source-walking-skeleton-spikes/latest.zip
      - aws s3 sync s3://prm-application-source/id_rsa ~/.ssh/ --region eu-central-1
      - git push --mirror git@github.com:nhsconnect/prm-infra.git
