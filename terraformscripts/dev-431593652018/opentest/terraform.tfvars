# ---------------------------------------------------------------------------------------------------------------------
# TERRAGRUNT CONFIGURATION
# This is the configuration for Terragrunt, a thin wrapper for Terraform that supports locking and enforces best
# practices: https://github.com/gruntwork-io/terragrunt
# ---------------------------------------------------------------------------------------------------------------------

terragrunt = {
  # Terragrunt will copy the Terraform configurations specified by the source parameter, along with any files in the
  # working directory, into a temporary folder, and execute your Terraform commands in that folder.
  terraform {
    source = "../..//tf/opentest"
  }

  iam_role = "arn:aws:iam::431593652018:role/PASTASLOTHVULGAR"

  dependencies {
    paths = ["../network"]
  }


  # Include all settings from the root terraform.tfvars.old.old file
  #include = {
  #  path = "${find_in_parent_folders()}"
  # }

  extra_arguments "conditional_vars" {
    commands = [
      "validate",
      "plan",
      "apply"
    ]


  # optional_var_files = [
  #     "${get_tfvars_dir()}/test.tfvars"
  #  ]


  #  arguments = [
  #    "-var",
  #    "prm-application-source-bucket=prm-application-source"
  #  ]
  }

  remote_state {
    backend = "s3"
    config {
      bucket = "prm-431593652018-terraform-states"
      key = "dev/opentest/terraform.tfstate"
      region = "eu-west-2"
      encrypt = true
    }
  }
}

# ---------------------------------------------------------------------------------------------------------------------
# MODULE PARAMETERS
# These are the variables we have to pass in to use the module specified in the terragrunt configuration above
# ---------------------------------------------------------------------------------------------------------------------

aws_region = "eu-west-2"
environment = "dev"

opentest-assets-bucket = "prm-431593652018-opentest-assets"

route_cidr_blocks = "192.168.128.0/24"

#Variables defined here seems to always take precedence over environment and optional_var_files defined vars. We need to understand this better.
#vpc_id = "vpc-8f3aaae7"
#vpc_subnet_private_ids = "subnet-c41e84ad,subnet-d547e1af,subnet-eb9763a7"

